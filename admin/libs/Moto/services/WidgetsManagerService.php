<?php
if (!defined('MOTO_WIDGETS_DIR')) define('MOTO_WIDGETS_DIR', MOTO_ROOT_DIR . '/widgets/'); class WidgetsManagerService { function getWidgets() { $responseVO = new ResponseVO(); $result = null; try { $manager = new Widgets_Manager_Local(); $result = $manager->getList(); } catch (Exception $e) { $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } function installWidget(WidgetVO $widgetVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $result = null; try { $manager = new Widgets_Manager_Local(); $result = $manager->install($widgetVO); } catch (Exception $e) { $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } function ___reInstallWidget(WidgetVO $widgetVO) { $responseVO = new ResponseVO(); $result = null; try { $otoWidgetsManager = new otoWidgetsManager(); $result = $otoWidgetsManager->reInstall($widgetVO); } catch (Exception $e) { $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } function unInstallWidget(WidgetVO $widgetVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $result = null; try { $manager = new Widgets_Manager_Local(); $result = $manager->uninstall($widgetVO); } catch (Exception $e) { $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } function extractFile($filename) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $result = null; try { if (!class_exists('ZipArchive', false)) throw new Exception('Class ZipArchive not extists'); $manager = new Widgets_Manager_Remote(); $result = $manager->addUploadedWidget($filename); } catch (Exception $e) { $result = $manager->getWidgetVO(); $responseVO->status->status = $e->getCode(); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } function clearCache($widgetVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $result = null; try { $manager = new Widgets_Manager(); $result = $manager->clearCache($widgetVO); } catch (Exception $e) { $result = $manager->getWidgetVO(); $responseVO->status->status = $e->getCode(); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } function overwriteWidget($widgetVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $result = null; try { $manager = new Widgets_Manager(); $result = $manager->overwriteWidget($widgetVO); } catch (Exception $e) { $result = $manager->getWidgetVO(); $responseVO->status->status = $e->getCode(); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } function updateWidget($widgetVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $result = null; try { $manager = new Widgets_Manager(); $result = $manager->updateWidget($widgetVO); } catch (Exception $e) { $result = $manager->getWidgetVO(); $responseVO->status->status = $e->getCode(); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } function activateWidget(WidgetVO $widgetVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $result = null; try { $manager = new Widgets_Manager_Local(); $result = $manager->activate($widgetVO); } catch (Exception $e) { $result = false; $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } function deActivateWidget(WidgetVO $widgetVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $result = null; try { $manager = new Widgets_Manager_Local(); $result = $manager->deactivate($widgetVO); } catch (Exception $e) { $result = false; $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } function removeWidget(WidgetVO $widgetVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $result = null; try { $manager = new Widgets_Manager_Local(); $result = $manager->remove($widgetVO); } catch (Exception $e) { $result = false; $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } public function getRemoteWidgets($request = '') { $responseVO = new ResponseVO(); $result = null; try { $manager = new Widgets_Manager_Remote(); $result = $manager->getList($request); } catch (Exception $e) { $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } public function addRemoteWidget($widgetVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $result = null; try { $manager = new Widgets_Manager_Remote(); $result = $manager->addWidget($widgetVO); } catch (Exception $e) { $result = null; $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } public function checkWidgetForUpdate(WidgetVO $widgetVO) { $responseVO = new ResponseVO(); $result = null; try { $manager = new Widgets_Manager_Remote(); $result = $manager->checkForUpdate($widgetVO); } catch (Exception $e) { $result = null; $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } public function checkWidgetsForUpdate($widgets) { $responseVO = new ResponseVO(); $result = null; try { $manager = new Widgets_Manager_Remote(); $result = $manager->checksForUpdate($widgets); } catch (Exception $e) { $result = null; $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } public function remoteUpdate(WidgetVO $widgetVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $result = null; try { $manager = new Widgets_Manager_Remote(); $result = $manager->update($widgetVO); } catch (Exception $e) { $result = null; $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } public function remoteLogin($user = null) { if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } if ($user == null) { $user = (object) array( 'login'=>'tester@devoffice.com', 'password' => '123123', ); } $responseVO = new ResponseVO(); $result = null; try { $manager = new Widgets_Manager_Remote(); $result = $manager->login($user); } catch (Exception $e) { $result = null; $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } public function remoteLogout() { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $result = null; try { $manager = new Widgets_Manager_Remote(); $result = $manager->logout(); } catch (Exception $e) { $result = null; $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } public function remoteApiCall($method, $params = array()) { $responseVO = new ResponseVO(); $result = null; try { $manager = new Widgets_Manager_Remote(); $result = $manager->call($method, $params); } catch (Exception $e) { $result = null; $responseVO->status->status = ($e->getCode() > 1 ? $e->getCode() : StatusEnum::ERROR_WHILE_WORKING_WITH_FILE); $responseVO->status->message = $e->getMessage(); } $responseVO->result = $result; return $responseVO; } } 