<?php
 class StructureService { public function __construct() { } public function getWebsiteStructure() { $responseVO = new ResponseVO(); $responseVO->status = new StatusVO(); try { $dom = new MotoXML(STRUCTURE_RESOURSE_PATH); $responseVO->result = new WebsiteHoldersStackVO(MotoXML::findOneByXPath('//website', $dom)); $responseVO->status->status = StatusEnum::SUCCESS; } catch (Exception $e) { $responseVO->result = null; $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; $responseVO->status->message = $e->getMessage(); } return $responseVO; } public function getLayoutsStructure() { $responseVO = new ResponseVO(); $responseVO->status = new StatusVO(); try { $dom = new MotoXML(STRUCTURE_RESOURSE_PATH); $responseVO->result = LayoutTypeVO::findAll(MotoXML::findOneByXPath('//layouts', $dom)); $responseVO->status->status = StatusEnum::SUCCESS; } catch (Exception $e) { $responseVO->result = null; $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; $responseVO->status->message = $e->getMessage(); } return $responseVO; } public function getPagesStructure() { $responseVO = new ResponseVO(); $responseVO->status = new StatusVO(); try { $dom = new MotoXML(STRUCTURE_RESOURSE_PATH); $responseVO->result = PageTypeVO::findAll(MotoXML::findOneByXPath('//pages', $dom)); $responseVO->status->status = StatusEnum::SUCCESS; } catch (Exception $e) { $responseVO->result = null; $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; $responseVO->status->message = $e->getMessage(); } return $responseVO; } public function getSlotsStructure() { $responseVO = new ResponseVO(); $responseVO->status = new StatusVO(); try { $dom = new MotoXML(STRUCTURE_RESOURSE_PATH); $responseVO->result = SlotTypeVO::findAll(MotoXML::findOneByXPath('//slots', $dom)); $responseVO->status->status = StatusEnum::SUCCESS; } catch (Exception $e) { $responseVO->result = null; $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; $responseVO->status->message = $e->getMessage(); } return $responseVO; } public function getModulesStructure() { $responseVO = new ResponseVO(); $responseVO->status = new StatusVO(); try { $dom = new MotoXML(STRUCTURE_RESOURSE_PATH); $responseVO->result = ModuleTypeVO::findAll(MotoXML::findOneByXPath('//modules', $dom)); $responseVO->status->status = StatusEnum::SUCCESS; } catch (Exception $e) { $responseVO->result = null; $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; $responseVO->status->message = $e->getMessage(); } return $responseVO; } public function getPopupsStructure() { $responseVO = new ResponseVO(); $responseVO->status = new StatusVO(); try { $dom = new MotoXML(STRUCTURE_RESOURSE_PATH); $responseVO->result = PopupTypeVO::findAll(MotoXML::findOneByXPath('//modules', $dom)); $responseVO->status->status = StatusEnum::SUCCESS; } catch (Exception $e) { $responseVO->result = null; $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; $responseVO->status->message = $e->getMessage(); } return $responseVO; } public function getStructure() { $responseVO = new ResponseVO(); $responseVO->status = new StatusVO(); try { $responseVO->result = new StructureVO(new MotoXML(STRUCTURE_RESOURSE_PATH)); $responseVO->status->status = StatusEnum::SUCCESS; } catch (Exception $e) { $responseVO->result = null; $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; $responseVO->status->message = $e->getMessage(); } return $responseVO; } public function updatePageTemplate(PageVO $pageVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $responseVO->status = new StatusVO(); $responseVO->result = null; $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; try { $dom = new MotoXML(STRUCTURE_RESOURSE_PATH); $pageNode = MotoXML::findOneByXPath('//pages/page[@id=' . $pageVO->pageType->id . ']', $dom); if (!is_null($pageNode)) { $responseVO->result = $pageVO->pageType->updateTemplate($pageNode, $pageVO); MotoXML::putXML($dom, STRUCTURE_RESOURSE_PATH); MotoUtil::setLoadEncodedDataFalse(); $responseVO->status->status = StatusEnum::SUCCESS; } } catch (Exception $e) { $responseVO->status->message = $e->getMessage(); } return $responseVO; } public function updatePopupTemplate(PopupVO $popupVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $responseVO->status = new StatusVO(); $responseVO->result = null; $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; try { $dom = new MotoXML(STRUCTURE_RESOURSE_PATH); $popupNode = MotoXML::findOneByXPath('//popups/popup[@id=' . $popupVO->popupType->id . ']', $dom); if (!is_null($popupNode)) { $responseVO->result = $popupVO->popupType->updateTemplate($popupNode, $popupVO); MotoXML::putXML($dom, STRUCTURE_RESOURSE_PATH); MotoUtil::setLoadEncodedDataFalse(); $responseVO->status->status = StatusEnum::SUCCESS; } } catch (Exception $e) { $responseVO->status->message = $e->getMessage(); } return $responseVO; } public function updateSlotTemplate(SlotVO $slotVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $responseVO->status = new StatusVO(); $responseVO->result = null; $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; try { $dom = new MotoXML(STRUCTURE_RESOURSE_PATH); $slotNode = MotoXML::findOneByXPath('//slots/slot[@id=' . $slotVO->slotType->id . ']', $dom); if (!is_null($slotNode)) { $responseVO->result = $slotVO->slotType->updateTemplate($slotNode, $slotVO); MotoXML::putXML($dom, STRUCTURE_RESOURSE_PATH); MotoUtil::setLoadEncodedDataFalse(); $responseVO->status->status = StatusEnum::SUCCESS; } } catch (Exception $e) { $responseVO->status->message = $e->getMessage(); } return $responseVO; } public function updateModuleTemplate(ModuleVO $moduleVO) { $responseVO = new ResponseVO(); if (DEMO_MODE === 'true') { $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; return $responseVO; } $responseVO->status = new StatusVO(); $responseVO->result = null; $responseVO->status->status = StatusEnum::ERROR_WHILE_WORKING_WITH_FILE; try { $dom = new MotoXML(STRUCTURE_RESOURSE_PATH); $moduleNode = MotoXML::findOneByXPath('//modules/module[@id=' . $moduleVO->moduleType->id . ']', $dom); if (!is_null($moduleNode)) { $responseVO->result = $moduleVO->moduleType->updateTemplate($moduleNode, $moduleVO); MotoXML::putXML($dom, STRUCTURE_RESOURSE_PATH); MotoUtil::setLoadEncodedDataFalse(); $responseVO->status->status = StatusEnum::SUCCESS; } } catch (Exception $e) { $responseVO->status->message = $e->getMessage(); } return $responseVO; } }