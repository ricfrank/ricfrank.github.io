<?php
if (!defined('CONTROL_PANEL_SYSTEM')) define('CONTROL_PANEL_SYSTEM', MOTO_ADMIN_DIR . '/xml/system.xml'); class MotoSystem { const MODULES_SECTION = 'modules'; const MODULES_DATAPROVIDERS = 'modulesDataProviders'; const WIDGET_SECTION = 'widgets'; const WIDGET_DATAPROVIDERS = 'widgetsDataProviders'; const _SECTION = 'Section'; private static $_dom; private static $rootNode = 'systemData'; private static function _getDOM() { if (self::$_dom != null) return self::$_dom; self::$_dom = MotoXML::create(CONTROL_PANEL_SYSTEM); return self::$_dom; } public static function getAccess($section, $key = '', $obj = null) { $result = null; try { if (!preg_match('/^[a-z0-9]+$/i', $section)) { return false; } if ($key != '' && !preg_match('/^[a-z0-9]+$/i', $key)) { return false; } $section .= self::_SECTION; $dom = self::_getDOM(); if (is_null($dom)) throw new Exception('Check you system.xml'); $root = MotoXML::findOneByXPath('/' . self::$rootNode, $dom); if (is_null($root)) { $root = new DOMElement(self::$rootNode); $dom->appendChild($root); } $sectionNode = MotoXML::findOneByXPath('./' . $section, $root); if (is_null($sectionNode)) { $sectionNode = new DOMElement($section); $root->appendChild($sectionNode); } $result = $sectionNode; if ($key != '' ) { $keyNode = MotoXML::findOneByXPath('./' . $key, $sectionNode); if (is_null($keyNode)) { $keyNode = new DOMElement($key); $sectionNode->appendChild($keyNode); } $result = $keyNode; } } catch (Exception $e) { MotoLog::getInstance()->err( __CLASS__ . ' : ' . $e->getMessage()); } return $result; } public static function save() { try { $user = new UserService(); if ($user->isAuthenticated()->status->status) { MotoXML::putXML(self::$_dom, CONTROL_PANEL_SYSTEM); } } catch (Exception $e) { MotoLog::getInstance()->err( __CLASS__ . ' : ' . $e->getMessage()); return false; } return true; } }